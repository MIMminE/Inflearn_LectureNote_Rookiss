# Section 4-3 스택과 힙

> 복사와 참조를 이해하기 위해서는 메모리 구조를 알아야 한다. 
> 기본적으로 스택과 힙 영역으로 구분지어져 있으며, 매우 얇은 수준의 개념만을 설명한다.
> 운영체제는 프로그램이 사용할 수 있는 메모리 공간을 정하고, 그 공간에서도 스택과 힙 영역으로 구분지어 관리한다.

### 스택
임시적으로 사용하는 메모리 공간.
- 함수를 호출할 때 임의의 값으로 할당되고 함수 종료와 함께 사라진다.
- 주로 함수 내부에서 선언되는 지역 변수들이 스택에 선언되고 각 함수 유효범위가 끝나는 시점에서 소멸한다.

### 힙 
프로그램 실행 중 동적으로 할당되는 메모리 공간.
- 동적 할당 등의 기법으로 실행 도중 데이터를 동적으로 할당되는 데이터 공간이다.
- 해당 함수가 종료되더라도 특정 해제 명령을 통해 공간을 반환하지 않으면 계속해서 해당 공간을 차지하고 있는다.
- 메모리 누수 등의 문제가 발생할 수 있지만, C#에 와서는 본체가 없다면 스스로 해제시켜주기도 한다.

> 저장 방식 중 참조 방식은 해당 메모리 주소를 변수에 저장하는 것을 의미하며, 이 때 주소는 컴퓨터 아키텍쳐가 64bit라면 64bit 주소가, 32bit라면 32bit 주소가 들어가게 된다.

> ref 타입을 붙이는 것이 동적할당을 의미하는 것이 아니다. 본체가 스택 영역에 있다면 스택 영역의 해당 메모리를 참조한다.

```C#
Knight knight = new Knight();
/* new 연산자로 생성된 객체는 힙 영역에 생성되며
   Knight 타입 변수 knight는 스택 영역에 생성되어 
   힙 영역에 생성된 실제 객체의 주소를 가지게 된다. */
```