# Section 1.10 <Context Switching>

```c#
while (true)
{
    int original = Interlocked.CompareExchange(ref _locked, 1, 0);
		// μ„Έ λ²μ§Έ μΈμμ™€ κ°’μ„ λΉ„κµν•μ—¬ λ‘ λ²μ§Έ μΈμλ΅ λ³€κ²½
    if (original == 0)
        break;
}
```

μ΄μ „ μ‹κ°„μ— κµ¬ν„ν• SpinLock λ΅μ§μ—μ„ λ½μ„ νλ“ν•μ§€ λ»ν–μ„ λ• μ–΄λ–¤ λ™μ‘μ„ ν•λƒμ— λ”°λΌ λ¬΄μ‘μ • κΈ°λ‹¤λ¦¬λ” μ¤ν•€λ½ λ™μ‘μ΄ μ•„λ‹ β€**μλ¦¬μ— λμ•„κ°€ νΉμ • μ‹κ°„ λ’¤μ— λ‹¤μ‹ μ¤λ”**β€™ λ°©λ²•μ΄ λ  μ μλ‹¤.

μλ¦¬λ΅ λμ•„κ°€λ” ν–‰λ™μ„ μ κ³µν•λ” ν•¨μλ΅λ” `Thread.Sleep`κ³Ό `Thread.Yield`κ°€ μλ‹¤.

```c#
while (true)
{
    int original = Interlocked.CompareExchange(ref _locked, 1, 0);
		// μ„Έ λ²μ§Έ μΈμμ™€ κ°’μ„ λΉ„κµν•μ—¬ λ‘ λ²μ§Έ μΈμλ΅ λ³€κ²½
    if (original == 0)
        break;

		Thread.Sleep(1);
		// μ§€μ •ν• μ‹κ°„(ms) λ¬΄μ΅°κ±΄ ν΄μ‹
		Thread.Sleep(0);
		// μ΅°κ±΄λ¶€ μ–‘λ³΄, λ‚λ³΄λ‹¤ μ°μ„ μμ„ λ‚®μΌλ©΄ μ–‘λ³΄X, μ¦‰μ‹ μ¬μ‹¤ν–‰λ  μ μμ
		Thread.Yield();
		// μ΅°κ±΄λ¶€ μ–‘λ³΄, μ‹¤ν–‰μ΄ κ°€λ¥ν• μ“°λ λ“κ°€ μλ‹¤λ©΄ μ°μ„ μμ„μ— μƒκ΄€μ—†μ΄ μ–‘λ³΄ν•¨
}
```

π’΅ **Sleepκ³Ό Yield μ μ°¨μ΄**

λ‘ ν•¨μ λ¨λ‘ μ¤λ λ“λ¥Ό μΌμ‹μ μΌλ΅ μ¤‘μ§€ν•κ±°λ‚ λ‹¤λ¥Έ μ¤λ λ“μ— μ‹¤ν–‰ κΈ°νλ¥Ό μ–‘λ³΄ν•λ” λ° μ‚¬μ©λλ” κ³µν†µμ μ€ μμ§€λ§ μ•½κ°„μ μ°¨μ΄κ°€ μ΅΄μ¬ν•λ‹¤.

**Sleep** 

- μ§€μ •λ μ‹κ°„λ™μ• μ¤λ λ“λ¥Ό μ¤‘μ§€μ‹ν‚¤λ©°, ν•΄λ‹Ή μ‹κ°„ μ΄ν›„μ— λ‹¤μ‹ μ‹¤ν–‰μ‹ν‚¨λ‹¤.
- νΉμ • μ‹κ°„ μ§€μ—°μ— μ‚¬μ©λλ‹¤. μλ¥Ό λ“¤μ–΄, μ¤λ λ“κ°€ νΉμ • μ‘μ—… μν–‰ν• ν›„ μΌμ • μ‹κ°„ λ™μ• λ€κΈ°ν•κ³  λ‹¤μ μ‘μ—…μ„ μ‹μ‘ν•λ” κ²½μ°μ— μ‚¬μ©λλ‹¤.

**Yield**

- ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ μ¤λ λ“κ°€ λ‹¤λ¥Έ μ¤λ λ“μ—κ² μ‹¤ν–‰ κΈ°νλ¥Ό μ–‘λ³΄ν•λ„λ΅ λ§λ“ λ‹¤. μ‹¤ν–‰μ΄ κ°€λ¥ν• λ‹¤λ¥Έ μ¤λ λ“κ°€ μ—†μ„ κ²½μ°, μ¦‰μ‹ μ‹¤ν–‰λ μλ„ μλ‹¤.
- μ¤λ λ“ κ°„μ ν‘λ ¥μ μΈ μ¤μΌ€μ¤„λ§μ„ μ§€μ›ν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤. μ¤λ λ“ κ°„ μ°μ„  μμ„μ— λ”°λΌ CPU μ μ  μ‹κ°„μ„ μ–‘λ³΄ν•κ³  μ¤λ λ“ κ°„ κ· ν•μ„ μ μ§€ν•λ‹¤.

κ²½μ°μ— λ”°λΌ μ‹¤ν–‰ μ‹κ°„μ„ μ–‘λ³΄ν•λ” κ²ƒμ΄ μΆ‹μ„ μ μλ‹¤. **(μ»¨ν…μ¤νΈ μ¤μ„μΉ­μ„ κ³ λ ¤ν•΄μ•Ό ν•λ‹¤)**

## Context Switching

---

λ‹¤μ¤‘ μ‘μ—… μ‹μ¤ν…μ—μ„ μ¤λ λ“ λλ” ν”„λ΅μ„Έμ¤ κ°„μ— CPU μ μ–΄κ¶μ„ μ „ν™ν•λ” μ‘μ—…μ„ λ§ν•λ‹¤. μ΄λ” μ¤μΌ€μ¤„λ§ λλ” μΈν„°λ½νΈμ— μν•΄ λ°μƒν•λ‹¤. 

- **μ¤μΌ€μ¤„λ§** : μ΄μμ²΄μ λ” μ—¬λ¬ μ¤λ λ“μ— CPUμ‹κ°„μ„ ν• λ‹Ήν•λ©°, ν•΄λ‹Ή μ‹κ°„μ„ μ „λ¶€ μ‚¬μ©ν•λ©΄ CPU μ‹¤ν–‰κΈ°νλ¥Ό λ‹¤λ¥Έ μ¤λ λ“μ—κ² μ „ν™ν•λ‹¤.
- **μΈν„°λ½νΈ** : μ”μ²­μ— μν•΄ λ°μƒν•λ‹¤. μ…μ¶λ ¥ μ™„λ£, νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ“±μ— μν•΄ λ°μƒν•κ³  μ‹¤ν–‰μ¤‘μ΄λ μ¤λ λ“μ μƒνƒλ¥Ό μ €μ¥ν•κ³  λ‹¤λ¥Έ μ¤λ λ“λ΅ μ „ν™ν•λ‹¤. (Sleep, Yield λ™μ‘λ„ μΈν„°λ½νΈ μ ν•μ— ν•΄λ‹Ή)

μ»¨ν…μ¤νΈ μ¤μ„μΉ­μ€ ν„μ¬ μ‹¤ν–‰μ¤‘μ΄λ μ¤λ λ“μ μƒνƒ(λ μ§€μ¤ν„° κ°’, ν”„λ΅κ·Έλ¨ μΉ΄μ΄ν„°, μ¤νƒ ν¬μΈν„° λ“±μ κ΄€λ ¨ μ •λ³΄)λ¥Ό μ €μ¥ν•κ³  CPU μ μ–΄κ¶μ„ μ „λ‹¬λ°›μ€ λ‹¤λ¥Έ μ¤λ λ“μ μƒνƒ μ •λ³΄λ¥Ό λ³µμ›ν•λ” μ‘μ—…μ„ λ¨λ‘ μν–‰ν•΄μ•Ό ν•λ‹¤. 

μ΄λ¬ν• μ μ— μν•΄ μ¤μ„μΉ­μ΄ λΉλ²ν•κ² λ°μƒν•λ©΄ μ‹μ¤ν…μ μ„±λ¥μ— λ¶€ν•λ¥Ό μ£Όκ² λλ‹¤. **(λ¶€ν•κ°€ μƒκ°λ³΄λ‹¤ ν° νΈμ— μ†ν•λ―€λ΅ μ¤μ„μΉ­μ΄ λ°μƒν•μ§€ μ•λ” μ¤ν•€λ½μ μ„±λ¥μ΄ μΆ‹λ‹¤κ³  λ³΄λ” κ²ƒμ΄λ‹¤)**

```
μΈν”„λ° Rookiss κ°•μ‚¬λ‹ λ΅λ“λ§µ 'C#κ³Ό μ λ‹ν‹°λ΅ λ§λ“λ” MMORPG κ²μ„ κ°λ° μ‹λ¦¬μ¦'μ— λ€ν• ν•™μµμ„ μ§„ν–‰ν•λ©΄μ„ μ‘μ„±ν• κ°μΈ κΈ°λ΅μ© κ°•μλ…ΈνΈμ…λ‹λ‹¤.
```
